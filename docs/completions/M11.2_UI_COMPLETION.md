# M11.2 Purchasing & Receiving Core - UI Implementation Complete

## Summary

M11.2 Web UI implementation for Purchase Orders and Goods Receipts management.

## Completion Date
2025-01-22

## Files Created

### Web UI Pages
- `apps/web/src/pages/inventory/purchase-orders/index.tsx` - PO list page with filters, create dialog, workflow actions
- `apps/web/src/pages/inventory/purchase-orders/[id].tsx` - PO detail page with lines, progress bars, actions
- `apps/web/src/pages/inventory/receipts/index.tsx` - Receipts list page with filters, create from PO flow
- `apps/web/src/pages/inventory/receipts/[id].tsx` - Receipt detail page with ledger entries display

### Tests
- `services/api/test/e2e/inventory-m112-procurement.e2e-spec.ts` - E2E tests (7 test groups)
- `apps/web/__tests__/m112-procurement-pages.test.tsx` - UI smoke tests

### Modified Files
- `apps/web/src/config/roleCapabilities.ts` - Added Purchase Orders and Receipts nav items for PROCUREMENT and STOCK_MANAGER roles

## Features Implemented

### Purchase Orders Page (`/inventory/purchase-orders`)
- List POs with status filter, search
- Create PO dialog with multi-line form (item, UOM, qty, unit cost)
- Status badges: DRAFT, PENDING_APPROVAL, APPROVED, PARTIALLY_RECEIVED, RECEIVED, CANCELLED
- Actions: Submit (L3+), Approve (L4+), Cancel (L4+)

### Purchase Order Detail Page (`/inventory/purchase-orders/[id]`)
- Header with vendor, branch, expected date, total amount
- Lines table with receiving progress bars (qty received / qty ordered)
- Notes display
- "Create Receipt" CTA link for approved/partially received POs

### Receipts Page (`/inventory/receipts`)
- List receipts with status filter, search
- Create receipt dialog - select PO, enter quantities per line, select locations
- Pre-populate lines from selected PO
- Actions: Post (L3+), Void (L4+)

### Receipt Detail Page (`/inventory/receipts/[id]`)
- Header with vendor, branch, received date, total cost
- Lines table with input UOM, base UOM quantities
- Ledger entries display after posting
- Posted by / posted at metadata

## RBAC Implementation

Using `hasRoleLevel()` from `@/lib/auth`:
- **L3+ (Manager)**: Create PO, Submit PO, Create Receipt, Post Receipt
- **L4+ (Owner)**: Approve PO, Cancel PO, Void Receipt

## E2E Test Coverage

7 test groups with 40+ assertions:
1. PO Create with UOM Conversion - verifies base qty calculation
2. PO Workflow RBAC - Submit L3+, Approve L4+, L2 forbidden
3. Receiving and Ledger Posting - base UOM ledger entries
4. Partial Receipt Status Updates - PARTIALLY_RECEIVED → RECEIVED
5. Over-Receipt Policy - rejects qty exceeding ordered
6. Receipt Post Idempotency - no duplicate ledger entries
7. Export Verification - CSV export endpoints

## Navigation Updates

Added to PROCUREMENT and STOCK_MANAGER roles:
- Purchase Orders → `/inventory/purchase-orders`
- Receipts → `/inventory/receipts`

## Tech Stack
- React, Next.js (pages router)
- @tanstack/react-query for data fetching
- shadcn/ui components (Card, Badge, Button, Dialog, Select, Input)
- useAuth from AuthContext for RBAC
- Inline table rendering (not DataTable component) for type safety

## Verification Gates
- [x] Lint passes (no errors)
- [x] TypeScript compiles (no type errors in new files)
- [x] E2E test file created with proper cleanup() pattern

## Commit Reference
TBD after push
