# M10.2 Parity Re-Audit

**Created:** 2026-01-03
**Baseline:** d6c2299 (M10.1 complete)

---

## 1. Audit Scope

Compare Nimbus M10.2 Workforce UI against:
- **Kimai (AGPL, STUDY-only)**: Behavior patterns only, no code reuse
- **Nimbus Prior UI**: finance/, reservations/, hr/ modules

---

## 2. Feature-by-Feature Parity Assessment

### A) Scheduling UI

| Aspect | Kimai Pattern | Nimbus Pattern | M10.2 Implementation | Verdict |
|--------|---------------|----------------|----------------------|---------|
| View Type | Calendar week/month | Table list (reservations) | Table with week date range | MEETS |
| Create Shift | Modal form | Dialog (reservations/policies) | Dialog with user/role/times | MEETS |
| Status Display | Color badges | Badge component (hr, finance) | Status badge with colors | MEETS |
| Publish Action | Bulk publish button | Bulk action (not existing) | Publish range button | MEETS |
| Conflict Detection | Inline warning | Toast/inline error | Inline error + toast | MEETS |
| Branch Filter | Project filter | Branch select (reservations) | Branch multi-select | MEETS |

**Evidence:**
- Status badge: [apps/web/src/components/ui/badge.tsx](apps/web/src/components/ui/badge.tsx)
- Dialog pattern: [apps/web/src/pages/reservations/policies.tsx](apps/web/src/pages/reservations/policies.tsx)
- Date range: [apps/web/src/pages/reservations/reports.tsx#L66-L67](apps/web/src/pages/reservations/reports.tsx#L66-L67)

**Verdict: MEETS**

---

### B) Timeclock UI

| Aspect | Kimai Pattern | Nimbus Pattern | M10.2 Implementation | Verdict |
|--------|---------------|----------------|----------------------|---------|
| Clock Status | Timer display | Status card (hr) | Status card with action buttons | MEETS |
| Clock Actions | Start/Stop buttons | Action buttons | Clock-in/out buttons | MEETS |
| Break Tracking | Pause/Resume | Not existing | Break start/end buttons | EXCEEDS |
| Recent Entries | List view | Table (hr) | Last 10 entries table | MEETS |
| Self-only RBAC | User filter | Role check | useAuth + self-filter | MEETS |

**Evidence:**
- Card layout: [apps/web/src/components/ui/card.tsx](apps/web/src/components/ui/card.tsx)
- Status display: [apps/web/src/pages/hr/index.tsx](apps/web/src/pages/hr/index.tsx)
- Auth context: [apps/web/src/contexts/AuthContext.tsx](apps/web/src/contexts/AuthContext.tsx)

**Verdict: MEETS**

---

### C) Approvals UI

| Aspect | Kimai Pattern | Nimbus Pattern | M10.2 Implementation | Verdict |
|--------|---------------|----------------|----------------------|---------|
| Queue Display | Pending list | Table (documents) | Table of COMPLETED shifts | MEETS |
| Approve Action | Action button | Button (finance journal) | Approve button per row | MEETS |
| Freeze on Approve | Read-only after | Badge + disabled | APPROVED badge, no actions | MEETS |
| Filters | Date/user filters | Date range (reservations) | Branch + date range | MEETS |

**Evidence:**
- Table: [apps/web/src/components/ui/table.tsx](apps/web/src/components/ui/table.tsx)
- Button actions: [apps/web/src/pages/finance/journal.tsx](apps/web/src/pages/finance/journal.tsx)

**Verdict: MEETS**

---

### D) Labor Reports UI

| Aspect | Kimai Pattern | Nimbus Pattern | M10.2 Implementation | Verdict |
|--------|---------------|----------------|----------------------|---------|
| KPI Cards | Summary stats | StatCard (finance) | 3 KPI cards | MEETS |
| Date Filters | Date range | Date inputs (reservations) | from/to date inputs | MEETS |
| Breakdown Tables | User/project tables | Tables | Per-role + per-user tables | MEETS |
| Export CSV | Download button | handleExport (reservations) | 3 export buttons | MEETS |

**Evidence:**
- StatCard: [apps/web/src/components/ui/stat-card.tsx](apps/web/src/components/ui/stat-card.tsx)
- Export pattern: [apps/web/src/pages/reservations/reports.tsx#L89-L108](apps/web/src/pages/reservations/reports.tsx#L89-L108)

**Verdict: MEETS**

---

### E) CSV Export UX

| Aspect | Kimai Pattern | Nimbus Pattern | M10.2 Implementation | Verdict |
|--------|---------------|----------------|----------------------|---------|
| Download Method | Blob download | Blob + URL.createObjectURL | Same pattern | MEETS |
| Filename | Date range in name | Date range in name | Same pattern | MEETS |
| Headers | Standard CSV | Standard CSV | Standard CSV | MEETS |

**Evidence:**
- Export code: [apps/web/src/pages/reservations/reports.tsx#L89-L108](apps/web/src/pages/reservations/reports.tsx#L89-L108)

**Verdict: MEETS**

---

### F) Audit Log UI

| Aspect | Kimai Pattern | Nimbus Pattern | M10.2 Implementation | Verdict |
|--------|---------------|----------------|----------------------|---------|
| Display | Table with filters | Table (staff, hr) | Table in labor page | MEETS |
| L5 Only | Admin only | Role check | L5 role check | MEETS |
| Payload View | Expandable JSON | Collapsible (not existing) | Collapsible row | EXCEEDS |

**Evidence:**
- Role check: [apps/web/src/components/RequireRole.tsx](apps/web/src/components/RequireRole.tsx)

**Verdict: MEETS**

---

### G) Seed + Migration

| Aspect | Requirement | Implementation | Verdict |
|--------|-------------|----------------|---------|
| Migration | Apply M10.1 schema | prisma migrate dev | MEETS |
| Tapas Seed | 6 shifts, 4 entries, 2 breaks, 6 logs | seedWorkforce() | MEETS |
| Cafesserie Seed | 12 shifts, 8 entries, 4 breaks, 12 logs | seedWorkforce() | MEETS |
| Idempotency | Cleanup before insert | deleteMany + upsert | MEETS |
| FK Order | Correct order | Orgs→Branches→Users→Shifts→Entries | MEETS |

**Verdict: MEETS**

---

## 3. Summary Verdict Table

| Feature Group | Verdict | Evidence |
|---------------|---------|----------|
| A) Scheduling UI | MEETS | Table + dialog + badge patterns from reservations |
| B) Timeclock UI | MEETS | Card + action button patterns from hr |
| C) Approvals UI | MEETS | Table + action patterns from finance |
| D) Labor Reports UI | MEETS | StatCard + export patterns from reservations |
| E) CSV Export UX | MEETS | Blob download pattern from reservations |
| F) Audit Log UI | MEETS | Table + role check patterns |
| G) Seed + Migration | MEETS | Follows demo seed patterns |

---

## 4. Non-Parity Items (Intentional Gaps)

| Item | Kimai Has | Nimbus Status | Rationale |
|------|-----------|---------------|-----------|
| Calendar drag-drop | Yes | Deferred | Week table simpler; can add M10.3 |
| Shift templates UI | Yes | Backend only | Templates via API; UI M10.3 |
| PDF export | Yes | Deferred | CSV sufficient for MVP |
| Approval comments | Yes | Deferred | Can add M10.3 |

---

## 5. Conclusion

All M10.2 features achieve **MEETS** parity with Kimai patterns (STUDY-only) and reuse established Nimbus UI patterns from finance, reservations, and hr modules. No code was copied from Kimai; only behavioral patterns were studied.
