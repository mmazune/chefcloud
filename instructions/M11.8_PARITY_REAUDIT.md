# M11.8 Parity Re-Audit

**Date:** January 6, 2026  
**Milestone:** M11.8 Inventory Returns + Recall/Quarantine + Expiry Enforcement

## Reference Comparison

Compared against InvenTree Stock Returns, Recall Management, and Expiry features.

## Parity Matrix

### 1. Vendor Returns

| InvenTree Feature | ChefCloud M11.8 | Status |
|-------------------|-----------------|--------|
| Create return order | POST /inventory/vendor-returns | ✅ |
| Return line items | VendorReturnLine model | ✅ |
| Draft/Pending states | DRAFT, SUBMITTED status | ✅ |
| Complete return | POST endpoint (status → POSTED) | ✅ |
| Cancel return | VOID status with reversal | ✅ |
| Stock adjustments on return | Ledger entries on POST | ✅ |
| Lot/batch tracking | lotId on VendorReturnLine | ✅ |

### 2. Recall/Quarantine Operations

| InvenTree Feature | ChefCloud M11.8 | Status |
|-------------------|-----------------|--------|
| Quarantine location | RecallCase + RecallLotLink | ✅ |
| Block stock from use | isLotUnderRecall() check | ✅ |
| Recall tracking | RecallCase with OPEN/CLOSED | ✅ |
| Impact reporting | getRecallImpact() | ✅ |
| Bulk lot linking | linkLot/unlinkLot endpoints | ✅ |

### 3. Expiry Enforcement

| InvenTree Feature | ChefCloud M11.8 | Status |
|-------------------|-----------------|--------|
| Expiry date tracking | InventoryLot.expiryDate | ✅ (M11.7) |
| Expiry status | LotStatus.EXPIRED | ✅ |
| Automatic expiry check | evaluateExpiry() callable | ✅ |
| Expiring soon report | getExpiringSoon() | ✅ |
| Expired stock report | getExpiredLots() | ✅ |

### 4. Exports & Reporting

| Feature | ChefCloud M11.8 | Status |
|---------|-----------------|--------|
| CSV export | exportReturns(), exportRecallCases(), exportExpiredLots() | ✅ |
| Hash verification | SHA256 hash in export response | ✅ |
| Audit trail | InventoryLedgerEntry with sourceType/sourceId | ✅ |

## Gaps Identified

| Gap | Severity | Notes |
|-----|----------|-------|
| Scheduled expiry evaluation | Low | Intentionally callable-only per spec |
| Return order approval workflow | Low | SUBMITTED→POSTED is single-step |
| Multiple return reasons per line | Low | Single `notes` field per line |

## Conclusion

**Parity Status: ACHIEVED**

M11.8 provides full parity with InvenTree's vendor returns, recall management, and expiry enforcement capabilities, with improvements in:
- FEFO allocation with recall blocking
- Idempotent operations
- Hash-verified exports
- RBAC-protected endpoints
