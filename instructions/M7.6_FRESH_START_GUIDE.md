# M7.6 Fresh Start Guide: Zero-Touch Demo Setup

**Status**: âœ… COMPLETE  
**Date**: 2025-01-24  
**Milestone**: M7.6 - Zero-Touch Demo Proof

---

## ğŸ¯ Purpose

This guide provides exact commands for setting up ChefCloud Demo from scratch on a fresh machine or workspace. No manual intervention required - one script does it all.

---

## âœ… Prerequisites

### Required Software
- **Node.js** 18+ (LTS recommended)
- **pnpm** (package manager): `npm install -g pnpm`
- **PostgreSQL** 14+ running and accessible

### Environment Setup

#### 1. Database Connection
Create `.env` in repo root:
```bash
# PostgreSQL connection
DATABASE_URL="postgresql://username:password@localhost:5432/chefcloud?schema=public"
```

#### 2. API Configuration
Create `.env` in `services/api`:
```bash
# Database (same as root)
DATABASE_URL="postgresql://username:password@localhost:5432/chefcloud?schema=public"

# JWT Secret (any random string)
JWT_SECRET="your-dev-secret-key-change-in-production"

# Enable demo data
SEED_DEMO_DATA=true

# CORS
CORS_ORIGIN="http://localhost:3000"
```

#### 3. Web App Configuration
Create `.env.local` in `apps/web`:
```bash
# API endpoint
NEXT_PUBLIC_API_URL=http://localhost:3001

# Demo fallback (set to false for production-like behavior)
NEXT_PUBLIC_ALLOW_DEMO_FALLBACK=false
```

---

## ğŸš€ Quick Start (One-Shot Script)

### Option A: PowerShell (Windows)
```powershell
# From repo root
.\scripts\demo-reset.ps1
```

### Option B: Bash (Linux/Mac/WSL)
```bash
# From repo root
chmod +x scripts/demo-reset.sh
./scripts/demo-reset.sh
```

### What the Script Does
1. âœ… Checks prerequisites (Node.js, pnpm)
2. ğŸ“¦ Installs dependencies (`pnpm install`)
3. ğŸ”¨ Builds packages (db, api)
4. ğŸ—„ï¸ Runs database migrations (`prisma migrate deploy`)
5. ğŸŒ± Seeds demo data (2 orgs, 1400+ orders, employees, inventory)
6. ğŸ§ª Runs verifiers:
   - `verify-demo-health.ts` - Checks data completeness
   - `verify-role-coverage.ts` - Tests RBAC across 19 roles (198 tests)
7. ğŸ“Š Reports PASS/FAIL and exits with appropriate code

**Expected Runtime**: 2-4 minutes depending on machine speed.

---

## ğŸ” Expected Output

### Success Case
```
ğŸš€ ChefCloud Zero-Touch Demo Reset
====================================

ğŸ“‹ Step 1/6: Checking prerequisites...
âœ… Prerequisites OK

ğŸ“¦ Step 2/6: Installing dependencies...
âœ… Dependencies installed

ğŸ”¨ Step 3/6: Building packages...
âœ… Build complete

ğŸ—„ï¸  Step 4/6: Running database migrations...
âœ… Migrations applied

ğŸŒ± Step 5/6: Seeding demo data...
âœ… Demo data seeded

ğŸ§ª Step 6/6: Running verification tests...
âœ… Demo health check PASSED
âœ… Role coverage verification PASSED

====================================
ğŸ“Š VERIFICATION SUMMARY
====================================
âœ… ALL TESTS PASSED

Demo is ready! You can now:
  1. Start API: cd services/api && pnpm start
  2. Start Web: cd apps/web && pnpm dev
  3. Login with test credentials (see below)
```

### Failure Case
If any verifier fails, the script exits with code 1 and shows details:
```
âŒ Role coverage verification FAILED

Check the output above for details.
See instructions/M7.6_FRESH_START_GUIDE.md for troubleshooting.
```

Check `instructions/M7.6_VERIFY_OUTPUT.txt` for detailed failure analysis.

---

## ğŸ‘¤ Test Credentials

After successful setup, login with these accounts:

### Organization: Tapas & Co
| Role | Email | Password | Level |
|------|-------|----------|-------|
| Owner | `owner@tapas.demo` | `demo123` | L5 |
| GM | `gm@tapas.demo` | `demo123` | L4 |
| Manager | `manager@tapas.demo` | `demo123` | L3 |
| Supervisor | `supervisor@tapas.demo` | `demo123` | L2 |
| Waiter | `waiter@tapas.demo` | `demo123` | L1 |

### Organization: Cafesserie
| Role | Email | Password | Level |
|------|-------|----------|-------|
| Owner | `owner@cafesserie.demo` | `demo123` | L5 |
| GM | `gm@cafesserie.demo` | `demo123` | L4 |
| Manager | `manager@cafesserie.demo` | `demo123` | L3 |
| Supervisor | `supervisor@cafesserie.demo` | `demo123` | L2 |
| Bartender | `bartender@cafesserie.demo` | `demo123` | L1 |

---

## ğŸƒ Running the Demo

### Step 1: Start API Server
```bash
cd services/api
pnpm start
```
Server runs on http://localhost:3001

### Step 2: Start Web App (new terminal)
```bash
cd apps/web
pnpm dev
```
App runs on http://localhost:3000

### Step 3: Login
1. Navigate to http://localhost:3000
2. Use any credential from the table above
3. Explore features based on role level

---

## ğŸ§ª Manual Verification (Optional)

If you want to run verifiers manually:

### 1. Demo Health Check
```bash
cd services/api
pnpm tsx ../../scripts/verify-demo-health.ts
```

Checks:
- Both orgs exist (Tapas, Cafesserie)
- Employees seeded (5+ each org)
- Orders exist (700+ per org)
- Inventory items seeded
- Menu items seeded

### 2. Role Coverage Test
```bash
cd services/api
pnpm tsx ../../scripts/verify-role-coverage.ts
```

Tests:
- 19 roles Ã— ~10 endpoints = 198 tests
- Expected: 196 passed, 2 legitimate RBAC denials
- Accounting: `198 = 196 + 0 + 2 + 0 + 0 âœ…`

Output saved to `instructions/M7.4_ROLE_VERIFY_OUTPUT.txt`

---

## ğŸ”§ Troubleshooting

### Issue: "pnpm: command not found"
```bash
npm install -g pnpm
```

### Issue: "PostgreSQL connection failed"
1. Check PostgreSQL is running
2. Verify `DATABASE_URL` in `.env` files
3. Test connection: `psql -h localhost -U username -d chefcloud`

### Issue: "Port 3001 already in use"
Kill existing process:
```bash
# Windows PowerShell
Get-Process -Id (Get-NetTCPConnection -LocalPort 3001).OwningProcess | Stop-Process

# Linux/Mac
lsof -ti :3001 | xargs kill -9
```

### Issue: "Migrations failed"
Reset database and re-run:
```bash
cd packages/db
pnpm prisma migrate reset --force
pnpm prisma migrate deploy
```

### Issue: "Verifiers failed"
1. Check `instructions/M7.6_VERIFY_OUTPUT.txt` for details
2. Ensure API server is running
3. Check seed data completeness
4. Compare to M7.4E baseline (0 failures expected)

---

## ğŸ“ Key Files

| File | Purpose |
|------|---------|
| `scripts/demo-reset.ps1` | Windows PowerShell one-shot script |
| `scripts/demo-reset.sh` | Bash one-shot script |
| `services/api/prisma/seed.ts` | Canonical seed entrypoint |
| `services/api/prisma/demo/seedComprehensive.ts` | Main data generator |
| `scripts/verify-demo-health.ts` | Data completeness verifier |
| `scripts/verify-role-coverage.ts` | RBAC endpoint verifier |

---

## ğŸ“ What Gets Seeded

### Organizations (2)
- **Tapas & Co**: Spanish restaurant (ID: org_tapas_001)
- **Cafesserie**: French cafÃ© (ID: org_cafesserie_001)

### Per Organization
- **Employees**: 5 (L1-L5 roles, except Cafesserie stops at L3)
- **Menu Items**: 30+ items across categories
- **Inventory**: 50+ items with realistic tracking
- **Orders**: 700+ historical orders (last 6 months)
- **Feedback**: 50+ customer feedback entries
- **Staff Feedback**: 20+ employee surveys

### Total Database Scale
- **~1,400 orders** across both orgs
- **10 employees** (5 per org)
- **100+ inventory items**
- **60+ menu items**
- **~70 feedback entries**

---

## âœ… Success Criteria

After running the one-shot script, you should have:

1. âœ… **Zero failures** in role coverage verifier (196 passed, 2 RBAC denials)
2. âœ… **Demo health** verifier passes all checks
3. âœ… **API starts** successfully on port 3001
4. âœ… **Web app** can login with test credentials
5. âœ… **Navigation** shows/hides based on role level
6. âœ… **No blank pages** - empty states render properly
7. âœ… **RBAC enforced** - L4 pages blocked for L1-L3 users

---

## ğŸ“Š Verification Output

The script generates `instructions/M7.6_VERIFY_OUTPUT.txt` with detailed results:

```
Role Coverage Verification - Tapas & Co (org_tapas_001)
========================================================

Testing Role: owner@tapas.demo (L5) ... 
  âœ“ GET /orders (10 results) ... 200 OK
  âœ“ GET /menu/items ... 200 OK
  âœ“ GET /inventory/items ... 200 OK
  ...

Final Summary:
- Total Planned:  198
- Passed:         196
- Failed:         0
- RBAC Denied:    2
- Errors:         0
- Skipped:        0
Reconciliation:   198 = 196 + 0 + 2 + 0 + 0 âœ…
```

---

## ğŸ”„ Re-Running Demo Reset

Safe to run multiple times:
- Seed uses **upsert logic** (won't duplicate data)
- Migrations are **idempotent** (safe to re-apply)
- Script **fails fast** on errors

To completely reset database:
```bash
cd packages/db
pnpm prisma migrate reset --force
cd ../..
./scripts/demo-reset.ps1  # or .sh
```

---

## ğŸ“š Related Documentation

- [M7.5_COMPLETION_SUMMARY.md](./M7.5_COMPLETION_SUMMARY.md) - RBAC UI enforcement
- [RBAC_VISIBILITY_MATRIX.md](./RBAC_VISIBILITY_MATRIX.md) - Role visibility rules
- [VERIFY_RUNBOOK.md](./VERIFY_RUNBOOK.md) - Manual verification steps
- [M7.4_ROLE_VERIFY_OUTPUT.txt](./M7.4_ROLE_VERIFY_OUTPUT.txt) - Baseline passing results

---

## ğŸ‰ Next Steps

Once demo is verified:

1. **Explore UI**: Login with different roles to see RBAC in action
2. **Check Navigation**: Verify menu items hide/show based on role
3. **Test Access Control**: Try accessing Finance page as L1 user
4. **Review Empty States**: Look at pages with no data to see EmptyState component
5. **Deploy to Production**: Follow DEPLOYMENT.md for production setup

---

**Last Updated**: 2025-01-24  
**Milestone**: M7.6 Complete  
**Verification**: âœ… 0 failures, 198 tests passing
