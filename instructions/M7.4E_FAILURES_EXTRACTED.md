# M7.4E Failures Extracted

> **Extracted from:** `/instructions/M7.4_ROLE_VERIFY_OUTPUT.txt`
> **Date:** 2025-12-24
> **Total:** 11 failures + 9 errors = 20 issues

---

## Summary by Category

| Category | Count | Affected Endpoints |
|----------|-------|-------------------|
| RBAC Mismatch | 8 | `/inventory/levels` (6), `/franchise/rankings` (2) |
| Seed Data Missing | 3 | `/hr/employees` (Cafesserie only) |
| DTO Param Mismatch | 6* | `/franchise/analytics/overview`, `/feedback/analytics/nps-summary` |

*Note: NPS summary was counted as "errors" (9) in original output, but 6 are from this test file version.

---

## Detailed Failures

### Failure 1: Tapas - Supervisor
- **Role:** L2 (Supervisor)
- **Endpoint:** `GET /inventory/levels`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L2 should have access (min: L2)"
- **Expected:** 200 with inventory data
- **Root Cause:** Backend requires L3, verifier says L2

### Failure 2: Tapas - Cashier
- **Role:** L2 (Cashier)
- **Endpoint:** `GET /inventory/levels`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L2 should have access (min: L2)"
- **Expected:** 200 with inventory data
- **Root Cause:** Backend requires L3, verifier says L2

### Failure 3: Tapas - Chef
- **Role:** L2 (Chef)
- **Endpoint:** `GET /inventory/levels`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L2 should have access (min: L2)"
- **Expected:** 200 with inventory data
- **Root Cause:** Backend requires L3, verifier says L2

### Failure 4: Cafesserie - Owner
- **Role:** L5 (Owner)
- **Endpoint:** `GET /hr/employees`
- **Status Code:** 200
- **Response:** Empty array `[]`
- **Message:** "Empty response - seed data missing or branchId mismatch"
- **Expected:** 200 with employee list
- **Root Cause:** `seedEmployees()` only seeds Tapas, not Cafesserie

### Failure 5: Cafesserie - Manager
- **Role:** L4 (Manager)
- **Endpoint:** `GET /hr/employees`
- **Status Code:** 200
- **Response:** Empty array `[]`
- **Message:** "Empty response - seed data missing or branchId mismatch"
- **Expected:** 200 with employee list
- **Root Cause:** `seedEmployees()` only seeds Tapas, not Cafesserie

### Failure 6: Cafesserie - Manager
- **Role:** L4 (Manager)
- **Endpoint:** `GET /franchise/rankings`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L4 should have access (min: L4)"
- **Expected:** 200 with rankings
- **Root Cause:** Backend requires L5, verifier says L4

### Failure 7: Cafesserie - Accountant
- **Role:** L4 (Accountant)
- **Endpoint:** `GET /hr/employees`
- **Status Code:** 200
- **Response:** Empty array `[]`
- **Message:** "Empty response - seed data missing or branchId mismatch"
- **Expected:** 200 with employee list
- **Root Cause:** `seedEmployees()` only seeds Tapas, not Cafesserie

### Failure 8: Cafesserie - Accountant
- **Role:** L4 (Accountant)
- **Endpoint:** `GET /franchise/rankings`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L4 should have access (min: L4)"
- **Expected:** 200 with rankings
- **Root Cause:** Backend requires L5, verifier says L4

### Failure 9: Cafesserie - Supervisor
- **Role:** L2 (Supervisor)
- **Endpoint:** `GET /inventory/levels`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L2 should have access (min: L2)"
- **Expected:** 200 with inventory data
- **Root Cause:** Backend requires L3, verifier says L2

### Failure 10: Cafesserie - Cashier
- **Role:** L2 (Cashier)
- **Endpoint:** `GET /inventory/levels`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L2 should have access (min: L2)"
- **Expected:** 200 with inventory data
- **Root Cause:** Backend requires L3, verifier says L2

### Failure 11: Cafesserie - Chef
- **Role:** L2 (Chef)
- **Endpoint:** `GET /inventory/levels`
- **Status Code:** 403
- **Response:** RBAC denied
- **Message:** "RBAC denied but user level L2 should have access (min: L2)"
- **Expected:** 200 with inventory data
- **Root Cause:** Backend requires L3, verifier says L2

---

## Errors (not counted as failures but need fixing)

### Error 1-6: NPS Summary (Tapas + Cafesserie L4/L5)
- **Endpoint:** `GET /feedback/analytics/nps-summary`
- **Status Code:** 400
- **Response:** "Request failed"
- **Root Cause:** Fixed in M7.4D - params `from/to` added

### Error 7-9: Franchise Overview (Cafesserie L4/L5)
- **Endpoint:** `GET /franchise/analytics/overview`
- **Status Code:** 400
- **Response:** "Request failed"
- **Root Cause:** Verifier sends `from/to`, DTO expects `startDate/endDate`
