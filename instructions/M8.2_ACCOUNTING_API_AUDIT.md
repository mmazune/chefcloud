# M8.2 Accounting API Audit

> **Date:** 2026-01-02  
> **Status:** Complete  

---

## 1. Current API Inventory

### /accounting (AccountingController)

| Method | Path | Roles | Description | Status |
|--------|------|-------|-------------|--------|
| POST | /accounting/vendors | L4, L5 | Create vendor | ✅ Exists |
| GET | /accounting/vendors | L4, L5 | List vendors | ✅ Exists |
| POST | /accounting/vendor-bills | L4, L5 | Create vendor bill | ✅ Exists |
| POST | /accounting/vendor-bills/:billId/open | L4, L5 | Mark bill as OPEN | ✅ Exists |
| POST | /accounting/vendor-payments | L4, L5 | Create vendor payment | ✅ Exists |
| GET | /accounting/ap/aging | L4, L5 | AP aging report | ✅ Exists |
| GET | /accounting/ar/aging | L4, L5 | AR aging report | ✅ Exists |
| GET | /accounting/trial-balance | L4, L5 | Trial balance | ✅ Exists |
| GET | /accounting/pnl | L4, L5 | Profit & Loss | ✅ Exists |
| GET | /accounting/balance-sheet | L4, L5 | Balance Sheet | ✅ Exists |

### /accounting/bank (BankRecController)

| Method | Path | Roles | Description | Status |
|--------|------|-------|-------------|--------|
| POST | /accounting/bank/accounts | L4, L5 | Create bank account | ✅ Exists |
| GET | /accounting/bank/accounts | L4, L5 | List bank accounts | ✅ Exists |
| POST | /accounting/bank/:accountId/import-csv | L4, L5 | Import bank statement CSV | ✅ Exists |
| POST | /accounting/bank/match | L4, L5 | Match bank txn to journal | ✅ Exists |
| POST | /accounting/bank/:accountId/auto-match | L4, L5 | Auto-match transactions | ✅ Exists |
| GET | /accounting/bank/unreconciled | L4, L5 | Get unreconciled items | ✅ Exists |

### /accounting/periods (PeriodsController)

| Method | Path | Roles | Description | Status |
|--------|------|-------|-------------|--------|
| POST | /accounting/periods | L5 | Create fiscal period | ✅ Exists |
| PATCH | /accounting/periods/:id/lock | L5 | Lock period | ✅ Exists |
| GET | /accounting/periods | L5 | List periods | ✅ Exists |
| GET | /accounting/periods/:id | L5 | Get period detail | ✅ Exists |

---

## 2. Missing Endpoints (Required for M8.2)

| Method | Path | Roles | Description | Priority |
|--------|------|-------|-------------|----------|
| GET | /accounting/accounts | L4, L5 | List chart of accounts | P0 |
| POST | /accounting/accounts | L5 | Create new account | P1 |
| GET | /accounting/journal | L4, L5 | List journal entries | P0 |
| POST | /accounting/journal | L4, L5 | Create manual journal entry | P1 |
| GET | /accounting/journal/:id | L4, L5 | Get journal entry detail | P1 |
| PATCH | /accounting/periods/:id/close | L5 | Soft-close period | P1 |

---

## 3. API Mismatches Found

### 3.1 Period Close vs Lock
- **Issue**: Only `PATCH /periods/:id/lock` exists; no separate close action
- **Docs expectation**: Close (soft) before Lock (hard)
- **Resolution**: Add `PATCH /periods/:id/close` endpoint

### 3.2 Journal Entry Endpoint Missing
- **Issue**: No endpoint to list or create journal entries
- **Docs expectation**: /accounting/journal for CRUD
- **Resolution**: Add GET /accounting/journal and POST /accounting/journal

### 3.3 Accounts Endpoint Missing
- **Issue**: No endpoint to list chart of accounts
- **Docs expectation**: /accounting/accounts for read access
- **Resolution**: Add GET /accounting/accounts

### 3.4 Role Requirements
- **Issue**: Periods controller requires L5 for all operations
- **Consideration**: Accountant (L4) should be able to view periods
- **Resolution**: Change GET /periods to L4, L5

---

## 4. Canonical Route Table (After M8.2)

### Chart of Accounts
| Method | Path | Query | Body | Roles | Platform |
|--------|------|-------|------|-------|----------|
| GET | /accounting/accounts | ?type=ASSET | - | L4, L5 | WEB |
| POST | /accounting/accounts | - | {code,name,type} | L5 | WEB |

### Journal Entries
| Method | Path | Query | Body | Roles | Platform |
|--------|------|-------|------|-------|----------|
| GET | /accounting/journal | ?from=&to=&branchId=&source= | - | L4, L5 | WEB |
| POST | /accounting/journal | - | {date,memo,lines:[{accountId,debit,credit}]} | L4, L5 | WEB |
| GET | /accounting/journal/:id | - | - | L4, L5 | WEB |

### Financial Statements
| Method | Path | Query | Body | Roles | Platform |
|--------|------|-------|------|-------|----------|
| GET | /accounting/trial-balance | ?asOf=&branchId= | - | L4, L5 | WEB |
| GET | /accounting/pnl | ?from=&to=&branchId= | - | L4, L5 | WEB |
| GET | /accounting/balance-sheet | ?asOf=&branchId= | - | L4, L5 | WEB |

### Fiscal Periods
| Method | Path | Query | Body | Roles | Platform |
|--------|------|-------|------|-------|----------|
| GET | /accounting/periods | ?status=OPEN | - | L4, L5 | WEB |
| GET | /accounting/periods/:id | - | - | L4, L5 | WEB |
| POST | /accounting/periods | - | {name,startsAt,endsAt} | L5 | WEB |
| PATCH | /accounting/periods/:id/close | - | - | L5 | WEB |
| PATCH | /accounting/periods/:id/lock | - | - | L5 | WEB |

### AP/AR
| Method | Path | Query | Body | Roles | Platform |
|--------|------|-------|------|-------|----------|
| GET | /accounting/ap/aging | - | - | L4, L5 | WEB |
| GET | /accounting/ar/aging | - | - | L4, L5 | WEB |
| GET | /accounting/vendors | - | - | L4, L5 | WEB |
| POST | /accounting/vendors | - | {name,email,...} | L4, L5 | WEB |
| POST | /accounting/vendor-bills | - | {vendorId,...} | L4, L5 | WEB |
| POST | /accounting/vendor-payments | - | {vendorId,...} | L4, L5 | WEB |

### Bank Reconciliation
| Method | Path | Query | Body | Roles | Platform |
|--------|------|-------|------|-------|----------|
| GET | /accounting/bank/accounts | - | - | L4, L5 | WEB |
| POST | /accounting/bank/accounts | - | {name,...} | L4, L5 | WEB |
| POST | /accounting/bank/:id/import-csv | - | FormData | L4, L5 | WEB |
| POST | /accounting/bank/match | - | {bankTxnId,journalEntryId} | L4, L5 | WEB |
| GET | /accounting/bank/unreconciled | - | - | L4, L5 | WEB |

---

## 5. Implementation Actions

| Action | File | Change |
|--------|------|--------|
| ADD | accounting.controller.ts | GET /accounts, GET /journal, POST /journal |
| ADD | accounting.service.ts | getAccounts(), getJournalEntries(), createJournalEntry() |
| MODIFY | periods.controller.ts | Add PATCH /:id/close, change GET to L4+ |

---

## 6. Compatibility Notes

- All new endpoints follow existing patterns
- No breaking changes to existing endpoints
- Frontend will use new endpoints for M8.2 accountant workspace
